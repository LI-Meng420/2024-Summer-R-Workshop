tb2011 <- tb2011 %>%
mutate(
appoint_date = as.character(任职日期),
appoint_date = case_when(
str_length(appoint_date) == 4 ~ str_glue("{appoint_date}0701"),
str_length(appoint_date) == 6 ~ str_glue("{appoint_date}15"),
TRUE ~ appoint_date
),
appoint_date = as.Date(appoint_date, format = "%Y%m%d"),
announce_date_wrong = as.Date(公告日期, format = "%Y%m%d"),
announce_date = 公告日期 %>%
as.character() %>%
as.Date(format = "%Y%m%d"),
resign_date = 离职日期 %>%
as.character() %>%
as.Date(format = "%Y%m%d")
) %>%
rename(country = 国际) %>%
mutate(
chinese = str_detect(country, "中国") %>%
value_if_na(FALSE)
)
tb2011 %>%
mutate(
chinese_num = as.numeric(chinese)
) %>%
ggplot() +
aes(appoint_date, chinese) +
geom_point() +
geom_smooth(
method = "lm"
)
tb2011 <- read_data(file)
tb2011 %>%
mutate(
appoint_date = as.character(任职日期),
appoint_date = case_when(
str_length(appoint_date) == 4 ~ str_glue("{appoint_date}0701"),
str_length(appoint_date) == 6 ~ str_glue("{appoint_date}15"),
TRUE ~ appoint_date
)
) %>%
relocate(任职日期, appoint_date)
tb2011 <- read_data(file)
tb2011 <- tb2011 %>%
mutate(
appoint_date = as.character(任职日期),
appoint_date = case_when(
str_length(appoint_date) == 4 ~ str_glue("{appoint_date}0701"),
str_length(appoint_date) == 6 ~ str_glue("{appoint_date}15"),
TRUE ~ appoint_date
),
appoint_date = as.Date(appoint_date, format = "%Y%m%d"),
announce_date_wrong = as.Date(公告日期, format = "%Y%m%d"),
announce_date = 公告日期 %>%
as.character() %>%
as.Date(format = "%Y%m%d"),
resign_date = 离职日期 %>%
as.character() %>%
as.Date(format = "%Y%m%d"),
country = 国际,
chinese = str_detect(country, "中国") %>%
value_if_na(FALSE)
)
tb2011 %>%
mutate(
chinese_num = as.numeric(chinese)
) %>%
ggplot() +
aes(appoint_date, chinese) +
geom_point() +
geom_smooth(
method = "lm"
)
tb2011 %>%
mutate(
chinese_num = as.numeric(chinese)
) %>%
ggplot() +
aes(appoint_date, chinese_num) +
geom_point() +
geom_smooth()
tb2011 %>%
mutate(
chinese_num = as.numeric(chinese)
) %>%
ggplot() +
aes(appoint_date, chinese_num) +
geom_smooth()
tb2011 %>%
mutate(
chinese_num = as.numeric(chinese)
) %>%
ggplot() +
aes(appoint_date, chinese_num) +
geom_smooth() +
coord_cartesian(ylim = c(.98, 1))
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month")
) %>%
summ(foreign, .by = appoint_ym)
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month")
) %>%
summ(chinese, .by = appoint_ym)
# Calculate the trend of foreign executives
tb2011 %>%
mutate(
foreign = 1 - chinese
) %>%
ggplot() +
aes(appoint_date, foreign) +
geom_smooth() +
coord_cartesian(ylim = c(0, .02))
# Calculate the trend of foreign executives
tb2011 %>%
mutate(
foreign = 1 - chinese
) %>%
ggplot() +
aes(appoint_date, foreign) +
geom_smooth() +
coord_cartesian(ylim = c(0, .02)) +
scale_y_continuous(labels = scales::percent_format())
# Calculate the trend of foreign executives
tb2011 %>%
mutate(
foreign = 1 - chinese
) %>%
ggplot() +
aes(appoint_date, foreign) +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month")
) %>%
summ(chinese, .by = appoint_ym)
tb2011 %>%
mutate(
appoint_ym = ym(appoint_date)
) %>%
summ(chinese, .by = appoint_ym)
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
appoint_month = month(appoint_date)
) %>%
summ(chinese, .by = appoint_year:appoint_month)
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
appoint_month = month(appoint_date)
) %>%
summ(chinese, .by = appoint_year:appoint_month) %>%
mutate(
appoint_ym = ym(appoint_year, appoint_month)
)
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
appoint_month = month(appoint_date)
) %>%
summ(chinese, .by = appoint_year:appoint_month) %>%
mutate(
appoint_ym = str_glue("{appoint_year}-{appoint_month}") %>% ym()
)
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month")
) %>%
summ(chinese, .by = appoint_ym)
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(chinese, .by = appoint_ym)
?floor_date
tb2011 %>%
mutate(
appoint_ym = round_date(appoint_date, "month")
) %>%
summ(chinese, .by = appoint_ym)
source("D:/R/Teaching/2024 Summer R Workshop/Week 6/explore_Chinese_firms.R", echo=TRUE)
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_smooth()
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_smooth()
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line()
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line()
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line() +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_point() +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_point() +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line() +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line(linetype = "dashed") +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line(linetype = "dashed", color = "gray") +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line(linetype = "dashed", color = "gray30") +
geom_smooth() +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_ym = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line(linetype = "dashed", color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line(linetype = "dashed", color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date)
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line(linetype = "dashed", color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date)
) %>%
summ(1 - chinese, .by = appoint_ym) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(linetype = "dashed", color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date)
) %>%
summ(1 - chinese, .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(linetype = "dashed", color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
# Group the date by year
appoint_year = floor_date(appoint_date, "year") + 181
) %>%
summ(1 - chinese, .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
# Directly extract the year (as a number)
appoint_year = year(appoint_date)
) %>%
summ(1 - chinese, .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date)
) %>%
summ(性别 == 女, .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date)
) %>%
summ(性别 == "女", .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth(se = FALSE) +
coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date)
) %>%
summ(性别 == "女", .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth(se = FALSE) +
# coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date)
) %>%
summ(性别 == "女", .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth() +
# coord_cartesian(ylim = c(0, .016)) +
scale_y_continuous(labels = scales::percent_format())
source("D:/R/Teaching/2024 Summer R Workshop/Week 6/explore_Chinese_firms.R", echo=TRUE)
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
age = appoint_year - 出生年份
) %>%
summ(age, .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth() +
scale_y_continuous(labels = scales::percent_format())
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
age = appoint_year - 出生年份
) %>%
summ(age, .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth()
tb2011 %>%
tab(出生年份)
tb2011 %>%
tab(出生年份) %>%
print_interval()
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
year_of_birth = as.character(出生年份) %>%
str_extract("^\\d{4}") %>%
as.numeric(),
age = appoint_year - year_of_birth,
) %>%
summ(age, .by = appoint_year) %>%
ggplot() +
aes(appoint_year, mean) +
geom_line(color = "gray30") +
geom_smooth()
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
year_of_birth = as.character(出生年份) %>%
str_extract("^\\d{4}") %>%
as.numeric(),
age = appoint_year - year_of_birth,
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(age, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_line(color = "gray30") +
geom_smooth()
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
year_of_birth = as.character(出生年份) %>%
str_extract("^\\d{4}") %>%
as.numeric(),
age = appoint_year - year_of_birth,
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(age, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_point() +
geom_smooth()
tb2011 %>%
mutate(
appoint_year = year(appoint_date),
year_of_birth = as.character(出生年份) %>%
str_extract("^\\d{4}") %>%
as.numeric(),
age = appoint_year - year_of_birth,
appoint_ym = floor_date(appoint_date, "month") + 14
) %>%
summ(age, .by = appoint_ym) %>%
ggplot() +
aes(appoint_ym, mean) +
geom_point() +
geom_smooth() +
statart:::theme_statart()
