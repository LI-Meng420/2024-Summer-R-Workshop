cncity_visit <- cncity %>%
left_join(cityvisit, by = c("地市" = "区划名称")) %>%
rename(
city = 地市,
prov = first_省区,
type = 类型
) %>%
mutate(
ln_area = log(shape_area),
ln_area = 10 - if_else(visit == 1, ln_area, NA_real_),
visit = visit == 1
)
# table <- cncity_visit %>%
#   rename(city = 地市,
#          prov = first_省区,
#          type = 类型) %>%
#   filter(is.na(visit)) %>%
#   tibble() %>%
#   select(city, prov)
# write_excel_csv(table, "table.csv")
# 重庆的下一级太小了
# table <- chongqingcounty %>%
#   tibble() %>%
#   select(地址, 省区)
# write_excel_csv(table, "table.csv")
g1 <- ggplot() +
annotation_map_tile(type = "osmtransport") +
geom_sf(
data = cncity_visit,
aes(fill = visit),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-2387082, 1654989),
xlim = c(-2500000, 3100000),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_manual(values = c("white", "firebrick")) +
# scale_fill_viridis_c(option = "F", na.value = "white", begin = .3, end = .4, direction = -1) +
annotation_scale(
location = "bl",
pad_x = unit(1, "cm"),
pad_y = unit(.5, "cm")
) +
annotation_north_arrow(
style = north_arrow_fancy_orienteering(),
location = "tl",
height = unit(2, "cm"),
width = unit(2, "cm"),
pad_x = unit(1, "cm"),
pad_y = unit(1, "cm")
) +
theme_void() +
theme(
axis.line = element_blank(),
panel.border = element_blank(),
legend.position = "none"
)
g2 <- ggplot() +
annotation_map_tile(type = "osmtransport", zoom = 2) +
geom_sf(
data = cncity_visit,
aes(fill = visit),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-4028017, -1877844),
xlim = c(117131.4, 2115095),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_manual(values = c("white", "firebrick")) +
# scale_fill_viridis_c(option = "F", na.value = "white", begin = .3, end = .4, direction = -1) +
scale_x_continuous(breaks = 120) +
scale_y_continuous(breaks = 0:2 * 10) +
theme(
# aspect.ratio = 1.25, #调节长宽比
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
# panel.grid = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(
fill = NA,
color = "grey10",
linetype = 1,
linewidth = 1
),
plot.margin = unit(c(0, 0, 0, 0), "mm"),
legend.position = "none"
)
ggdraw() +
draw_plot(g1) +
draw_plot(
g2,
x = 0.79,
y = -.13,
width = 0.2,
height = 0.6
)
}
travel_plot()
ggsave("travelmap.png", width = 12, height = 8.67)
# ==============================================================
travel_plot <- function() {
current_folder <- "D:/R/China Travel Map/"
cityvisit <- current_folder %>%
paste0("visited_cities.csv") %>%
read_csv()
cncity_visit <- cncity %>%
left_join(cityvisit, by = c("地市" = "区划名称")) %>%
rename(
city = 地市,
prov = first_省区,
type = 类型
) %>%
mutate(
ln_area = log(shape_area),
ln_area = 10 - if_else(visit == 1, ln_area, NA_real_),
visit = visit == 1
)
# table <- cncity_visit %>%
#   rename(city = 地市,
#          prov = first_省区,
#          type = 类型) %>%
#   filter(is.na(visit)) %>%
#   tibble() %>%
#   select(city, prov)
# write_excel_csv(table, "table.csv")
# 重庆的下一级太小了
# table <- chongqingcounty %>%
#   tibble() %>%
#   select(地址, 省区)
# write_excel_csv(table, "table.csv")
g1 <- ggplot() +
annotation_map_tile(type = "osmtransport") +
geom_sf(
data = cncity_visit,
aes(fill = visit),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-2387082, 1654989),
xlim = c(-2500000, 3100000),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_manual(values = c("white", "firebrick")) +
# scale_fill_viridis_c(option = "F", na.value = "white", begin = .3, end = .4, direction = -1) +
annotation_scale(
location = "bl",
pad_x = unit(1, "cm"),
pad_y = unit(.5, "cm")
) +
annotation_north_arrow(
style = north_arrow_fancy_orienteering(),
location = "tl",
height = unit(2, "cm"),
width = unit(2, "cm"),
pad_x = unit(1, "cm"),
pad_y = unit(1, "cm")
) +
theme_void() +
theme(
axis.line = element_blank(),
panel.border = element_blank(),
legend.position = "none"
)
g2 <- ggplot() +
annotation_map_tile(type = "osmtransport", zoom = 2) +
geom_sf(
data = cncity_visit,
aes(fill = visit),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-4028017, -1877844),
xlim = c(117131.4, 2115095),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_manual(values = c("white", "darkblue")) +
# scale_fill_viridis_c(option = "F", na.value = "white", begin = .3, end = .4, direction = -1) +
scale_x_continuous(breaks = 120) +
scale_y_continuous(breaks = 0:2 * 10) +
theme(
# aspect.ratio = 1.25, #调节长宽比
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
# panel.grid = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(
fill = NA,
color = "grey10",
linetype = 1,
linewidth = 1
),
plot.margin = unit(c(0, 0, 0, 0), "mm"),
legend.position = "none"
)
ggdraw() +
draw_plot(g1) +
draw_plot(
g2,
x = 0.79,
y = -.13,
width = 0.2,
height = 0.6
)
}
travel_plot()
ggsave("travelmap.png", width = 12, height = 8.67)
# ==============================================================
travel_plot <- function() {
current_folder <- "D:/R/China Travel Map/"
cityvisit <- current_folder %>%
paste0("visited_cities.csv") %>%
read_csv()
cncity_visit <- cncity %>%
left_join(cityvisit, by = c("地市" = "区划名称")) %>%
rename(
city = 地市,
prov = first_省区,
type = 类型
) %>%
mutate(
ln_area = log(shape_area),
ln_area = 10 - if_else(visit == 1, ln_area, NA_real_),
visit = visit == 1
)
# table <- cncity_visit %>%
#   rename(city = 地市,
#          prov = first_省区,
#          type = 类型) %>%
#   filter(is.na(visit)) %>%
#   tibble() %>%
#   select(city, prov)
# write_excel_csv(table, "table.csv")
# 重庆的下一级太小了
# table <- chongqingcounty %>%
#   tibble() %>%
#   select(地址, 省区)
# write_excel_csv(table, "table.csv")
g1 <- ggplot() +
annotation_map_tile(type = "osmtransport") +
geom_sf(
data = cncity_visit,
aes(fill = visit),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-2387082, 1654989),
xlim = c(-2500000, 3100000),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_manual(values = c("white", "darkblue")) +
# scale_fill_viridis_c(option = "F", na.value = "white", begin = .3, end = .4, direction = -1) +
annotation_scale(
location = "bl",
pad_x = unit(1, "cm"),
pad_y = unit(.5, "cm")
) +
annotation_north_arrow(
style = north_arrow_fancy_orienteering(),
location = "tl",
height = unit(2, "cm"),
width = unit(2, "cm"),
pad_x = unit(1, "cm"),
pad_y = unit(1, "cm")
) +
theme_void() +
theme(
axis.line = element_blank(),
panel.border = element_blank(),
legend.position = "none"
)
g2 <- ggplot() +
annotation_map_tile(type = "osmtransport", zoom = 2) +
geom_sf(
data = cncity_visit,
aes(fill = visit),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-4028017, -1877844),
xlim = c(117131.4, 2115095),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_manual(values = c("white", "darkblue")) +
# scale_fill_viridis_c(option = "F", na.value = "white", begin = .3, end = .4, direction = -1) +
scale_x_continuous(breaks = 120) +
scale_y_continuous(breaks = 0:2 * 10) +
theme(
# aspect.ratio = 1.25, #调节长宽比
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
# panel.grid = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(
fill = NA,
color = "grey10",
linetype = 1,
linewidth = 1
),
plot.margin = unit(c(0, 0, 0, 0), "mm"),
legend.position = "none"
)
ggdraw() +
draw_plot(g1) +
draw_plot(
g2,
x = 0.79,
y = -.13,
width = 0.2,
height = 0.6
)
}
travel_plot()
ggsave("travelmap.png", width = 12, height = 8.67)
# ==============================================================
travel_plot_year <- function() {
current_folder <- "D:/R/China Travel Map/"
cityvisit <- current_folder %>%
paste0("visited_cities.csv") %>%
read_csv()
cncity_visit <- cncity %>%
left_join(cityvisit, by = c("地市" = "区划名称")) %>%
rename(
city = 地市,
prov = first_省区,
type = 类型
) %>%
mutate(
ln_area = log(shape_area),
ln_area = 10 - if_else(visit == 1, ln_area, NA_real_),
visit = visit == 1
)
# table <- cncity_visit %>%
#   rename(city = 地市,
#          prov = first_省区,
#          type = 类型) %>%
#   filter(is.na(visit)) %>%
#   tibble() %>%
#   select(city, prov)
# write_excel_csv(table, "table.csv")
# 重庆的下一级太小了
# table <- chongqingcounty %>%
#   tibble() %>%
#   select(地址, 省区)
# write_excel_csv(table, "table.csv")
g1 <- ggplot() +
annotation_map_tile(type = "osmtransport") +
geom_sf(
data = cncity_visit,
aes(fill = lastyear),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-2387082, 1654989),
xlim = c(-2500000, 3100000),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_viridis_c(na.value = "white", direction = -1) +
annotation_scale(
location = "bl",
pad_x = unit(1, "cm"),
pad_y = unit(.5, "cm")
) +
annotation_north_arrow(
style = north_arrow_fancy_orienteering(),
location = "tl",
height = unit(2, "cm"),
width = unit(2, "cm"),
pad_x = unit(1, "cm"),
pad_y = unit(1, "cm")
) +
theme_void() +
theme(
axis.line = element_blank(),
panel.border = element_blank(),
legend.position = "none"
)
g2 <- ggplot() +
annotation_map_tile(type = "osmtransport", zoom = 2) +
geom_sf(
data = cncity_visit,
aes(fill = lastyear),
color = "lightgray",
lwd = .15
) +
geom_sf(
data = cnprov,
fill = NA,
color = "darkgray",
lwd = .3
) +
geom_sf(data = cnboundary_land, lwd = 1) +
geom_sf(data = cnboundary_sea, color = "#444444", lwd = .05) +
geom_sf(data = southsea_nine_dash, color = "black", lwd = 1) +
geom_sf(data = southsea_islands, color = "#444444") +
coord_sf(
ylim = c(-4028017, -1877844),
xlim = c(117131.4, 2115095),
crs = "+proj=laea +lat_0=40 +lon_0=104"
) +
scale_fill_viridis_c(na.value = "white", direction = -1) +
scale_x_continuous(breaks = 120) +
scale_y_continuous(breaks = 0:2 * 10) +
theme(
# aspect.ratio = 1.25, #调节长宽比
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
# panel.grid = element_blank(),
panel.background = element_blank(),
panel.border = element_rect(
fill = NA,
color = "grey10",
linetype = 1,
size = 1
),
plot.margin = unit(c(0, 0, 0, 0), "mm"),
legend.position = "none"
)
ggdraw() +
draw_plot(g1) +
draw_plot(
g2,
x = 0.79,
y = -.13,
width = 0.2,
height = 0.6
)
}
travel_plot_year()
ggsave("travelmapyear.png", width = 12, height = 8.67)
